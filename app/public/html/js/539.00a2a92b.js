"use strict";(self["webpackChunkvue_test"]=self["webpackChunkvue_test"]||[]).push([[539],{6539:function(e,t,a){a.r(t),a.d(t,{default:function(){return m}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"task-list-detail"},[t("div",{staticClass:"task-list-detail-search"},[t("el-form",{ref:"taskListDetailSearchForm",attrs:{inline:!0,model:e.searchForm,rules:e.searchFormRules}},[t("el-form-item",{attrs:{label:"用户：",prop:"userKey"}},[t("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择用户",clearable:!0},model:{value:e.searchForm.userKey,callback:function(t){e.$set(e.searchForm,"userKey",t)},expression:"searchForm.userKey"}},e._l(e.allMembers,(function(e){return t("el-option",{key:e.username,attrs:{label:e.name,value:e.username}})})),1)],1),t("el-form-item",{attrs:{label:"环境：",prop:"envKey"}},[t("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择环境",clearable:!0},model:{value:e.searchForm.envKey,callback:function(t){e.$set(e.searchForm,"envKey",t)},expression:"searchForm.envKey"}},e._l(e.allProjects,(function(e){return t("el-option",{key:e.key,attrs:{label:e.description,value:e.key}})})),1)],1),t("el-form-item",{attrs:{label:"开始时间：",prop:"startTime"}},[t("el-date-picker",{staticStyle:{width:"185px"},attrs:{type:"datetime",placeholder:"请选择开始时间","value-format":"timestamp"},model:{value:e.searchForm.startTime,callback:function(t){e.$set(e.searchForm,"startTime",t)},expression:"searchForm.startTime"}})],1),t("el-form-item",{attrs:{label:"结束时间：",prop:"endTime"}},[t("el-date-picker",{staticStyle:{width:"185px"},attrs:{type:"datetime",placeholder:"请选择结束时间","value-format":"timestamp"},model:{value:e.searchForm.endTime,callback:function(t){e.$set(e.searchForm,"endTime",t)},expression:"searchForm.endTime"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSearch("taskListDetailSearchForm")}}},[e._v("查询")]),t("el-button",{on:{click:function(t){return e.$refs["taskListDetailSearchForm"].resetFields()}}},[e._v("重置")])],1)],1)],1),t("div",{staticClass:"task-list-detail-table"},[t("el-table",{attrs:{data:e.taskTrendListTableData,"max-height":e.tableHeight}},[t("el-table-column",{attrs:{prop:"userName",label:"用户"}}),t("el-table-column",{attrs:{prop:"envName",label:"环境"}}),t("el-table-column",{attrs:{prop:"action",label:"状态"}}),t("el-table-column",{attrs:{prop:"time",label:"时间"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(new Date(a.row.time).toLocaleString()))])]}}])})],1),t("el-pagination",{staticStyle:{"padding-top":"14px","text-align":"end"},attrs:{"current-page":e.page.currentPage,"page-sizes":[20,50,100,200],"page-size":e.page.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.taskTrendListData.length},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)])},s=[],n=(a(1703),a(5e3)),i=a(9195),l={data(){const e=(e,t,a)=>{this.searchForm.endTime&&t&&this.searchForm.endTime<t&&a(new Error("开始时间不能大于结束时间")),a()},t=(e,t,a)=>{this.searchForm.startTime&&t&&this.searchForm.startTime>t&&a(new Error("结束时间不能小于开始时间")),a()};return{searchForm:{userKey:"",envKey:"",startTime:null,endTime:null},allProjects:[],allMembers:[],taskTrendListData:[],taskTrendListTableData:[],tableHeight:500,page:{currentPage:1,pageSize:20},searchFormRules:{startTime:[{validator:e,trigger:"blur"}],endTime:[{validator:t,trigger:"blur"}]}}},methods:{async getProjects(){const e=await(0,n.mW)();e.code>0&&(this.allProjects=e.data)},async getMembers(){const e=await(0,i.Zw)();e.code>0&&(this.allMembers=e.data)},async getTaskTrendList(){const e=await(0,n.r3)(this.searchForm);e.code>0&&(this.taskTrendListData=e.data,this.resetPage(),this.sliceTableData())},handleSearch(e){this.$refs[e].validate((e=>{if(!e)return!1;this.getTaskTrendList()}))},sliceTableData(){const{currentPage:e,pageSize:t}=this.page;this.taskTrendListTableData=this.taskTrendListData.slice((e-1)*t,e*t)},handleSizeChange(e){this.page.pageSize=e,this.sliceTableData()},handleCurrentChange(e){this.page.currentPage=e,this.sliceTableData()},resetPage(){this.page.currentPage=1}},created(){this.getProjects(),this.getMembers(),this.getTaskTrendList(),this.tableHeight=window.innerHeight-50-44-28-65-28}},o=l,c=a(1001),u=(0,c.Z)(o,r,s,!1,null,"70d2c5c6",null),m=u.exports},5e3:function(e,t,a){a.d(t,{B_:function(){return i},Ti:function(){return o},Z1:function(){return n},mW:function(){return s},r3:function(){return l}});var r=a(7861);async function s(e){return(0,r.W)("/file/getProjects",{method:"GET",params:e})}async function n(e){return(0,r.W)("/file/writeEnv",{method:"POST",data:e})}async function i(e){return(0,r.W)("/file/getEnvDeps",{method:"GET",params:e})}async function l(e){return(0,r.W)("/file/getActionRecordList",{method:"POST",data:e})}async function o(e){return(0,r.W)("/file/environmentSetting",{method:"GET",params:e})}},9195:function(e,t,a){a.d(t,{Zw:function(){return i},bG:function(){return l},bs:function(){return o},kS:function(){return n},x4:function(){return s}});var r=a(7861);const s=async e=>(0,r.W)("/user/login",{method:"POST",data:e}),n=async e=>(0,r.W)("/user/logout",{method:"POST",data:e}),i=async e=>(0,r.W)("/user/getMembers",{method:"GET",params:e}),l=async e=>(0,r.W)("/user/getUserInfo",{method:"GET",params:e}),o=async e=>(0,r.W)("/user/changePassWord",{method:"POST",data:e})}}]);