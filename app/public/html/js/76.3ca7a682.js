"use strict";(self["webpackChunkvue_test"]=self["webpackChunkvue_test"]||[]).push([[76],{4076:function(e,t,n){n.r(t),n.d(t,{default:function(){return W}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"task-setting"},[t("top-info"),t("version-selection"),t("bottom-button")],1)},s=[],i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"task-setting-top-info"},[t("div",[t("el-avatar",{style:{marginRight:"14px"},attrs:{src:e.envInfo.icon??e.avaUrl}})],1),t("div",{staticClass:"info"},[t("div",[e._v(e._s(e.envInfo.description))]),t("div",[e._v("创建人: "+e._s(e.envInfo.creatBy))]),t("div",[e._v(" 创建时间："+e._s(new Date(e.envInfo.creatTime).toLocaleDateString().replace(/\//g,"-"))+" ")]),t("div",[e._v("修改人: "+e._s(e.envInfo.updateBy))]),t("div",[e._v(" 修改时间："+e._s(new Date(e.envInfo.updateTime).toLocaleString().replace(/\//g,"-"))+" ")])])])},o=[],r={components:{},name:"TopInfo",data(){return{envInfo:this.$store.getters.envInfo,title:"配置",avaUrl:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"}}},c=r,l=n(1001),u=(0,l.Z)(c,i,o,!1,null,"383a0bdc",null),f=u.exports,d=function(){var e=this,t=e._self._c;return t("div",{staticClass:"task-setting-version-selection"},[t("div",{staticClass:"top-title borderBottom"},[e._v(e._s(e.title))]),e._l(e.allPackages,(function(n){return t("div",{key:n._id,staticClass:"packages-list"},[t("span",{staticClass:"package-name",on:{click:function(t){return e.getPackageReadme(n.name,n.version,n.description)}}},[e._v(e._s(e.filterLabel(n.name)))]),t("el-select",{attrs:{filterable:"",loading:e.selectLoading},on:{"visible-change":t=>e.getPackageInfo(t,n.name)},model:{value:n.version,callback:function(t){e.$set(n,"version",t)},expression:"i.version"}},e._l(e.packageOptions[n.name],(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)})),t("el-dialog",{attrs:{"custom-class":"package-readme-dialog",center:!0,top:"10vh",title:e.dialog.title,visible:e.dialog.visible},on:{"update:visible":function(t){return e.$set(e.dialog,"visible",t)}}},[t("div",{staticClass:"markdown-body",domProps:{innerHTML:e._s(e.dialog.info)}})])],2)},g=[],v=n(7861);async function m(e){return(0,v.W)("/verdaccio/getAllPackages",{method:"GET",params:e})}async function p(e){return(0,v.W)("/verdaccio/getPackageInfo",{method:"GET",params:e})}async function h(e){return(0,v.W)("/verdaccio/getPackageReadme",{method:"GET",params:e})}var k=n(5e3),y={name:"VersionSelection",data(){return{title:"依赖包版本选择",allPackages:[],selectLoading:!1,packageOptions:{},dialog:{title:"",visible:!1,info:""}}},methods:{async getAllPackages(){const e=await m(),t=await(0,k.B_)({key:this.$store.getters.envInfo.key});if(e.code>0&&(this.allPackages=e.data.filter((e=>e.name.includes("@zglib/product-system")))),t.code>0)for(const[n,a]of Object.entries(t.data))this.allPackages=this.allPackages.map((e=>{const t={...e};return t.name===n&&(t.version=a),t}))},async getPackageInfo(e,t){if(e&&!this.packageOptions[t]){this.selectLoading=!0;const e=await p({name:t});if(e.code>0){const n=e.data.versions,a=Object.keys(n);this.packageOptions[t]=a}this.selectLoading=!1}},async getPackageReadme(e,t,n){const a=await h({name:e,version:t});a.code>0&&(this.dialog.info=a.data,this.dialog.title=`${n} V${t}`,this.dialog.visible=!0)},filterLabel:e=>e?.replace("@zglib/","")},mounted(){this.getAllPackages()},watch:{allPackages:{deep:!0,handler(e){const t={};e.forEach((e=>{t[e.name]=e.version})),this.$store.commit("setPackageList",t)}}}},b=y,_=(0,l.Z)(b,d,g,!1,null,"1647f8b4",null),$=_.exports,L=function(){var e=this,t=e._self._c;return t("footer",{staticClass:"task-setting-bottom-button"},[t("el-button",{attrs:{type:"primary"},on:{click:e.handleApplyConfig}},[e._v("应用配置")]),t("el-button",{on:{click:function(t){return e.$router.back()}}},[e._v("返回")])],1)},P=[],I={name:"BottomButton",methods:{async handleApplyConfig(){const e=this.$loading({lock:!0,text:"正在更改配置中。。。",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),t=await(0,k.Z1)({depData:this.$store.getters.packageList,envName:this.$store.getters.envInfo.key});this.$message({message:t.msg,type:t.code>0?"success":"error"}),e.close()}}},T=I,C=(0,l.Z)(T,L,P,!1,null,"02bf0e86",null),E=C.exports,w={components:{TopInfo:f,VersionSelection:$,BottomButton:E},name:"TaskSetting",data(){return{envKey:this.$store.getters.envInfo.key,username:this.$store.getters.userInfo.username,notifyList:{}}},beforeRouteEnter(e,t,n){n((e=>{(0,k.Ti)({envKey:e.envKey}).then((t=>{if(t.code>0){const n=t.data;n.forEach((t=>{const{name:n,username:a}=t;e.username!==a&&e.setNotifyDialog(n,a)}))}}))}))},beforeRouteLeave(e,t,n){Object.keys(this.notifyList).forEach((e=>{this.notifyList[e].close()})),(0,k.Ti)({envKey:this.envKey,isLeave:!0}),n()},methods:{setNotifyDialog(e,t,n=!1){this.notifyList[`${this.envKey}${t}`]=this.$notify({message:`${e} ${n?"已修改完成,请刷新":"正在修改此配置"}`,duration:3e3,showClose:!1})}},sockets:{leaveEnvironmentSetting(e){const{envKey:t,name:n,username:a}=e;t===this.envKey&&this.notifyList[`${this.envKey}${a}`]&&this.setNotifyDialog(n,a,!0)}}},B=w,K=(0,l.Z)(B,a,s,!1,null,null,null),W=K.exports},5e3:function(e,t,n){n.d(t,{B_:function(){return o},Ti:function(){return c},Z1:function(){return i},mW:function(){return s},r3:function(){return r}});var a=n(7861);async function s(e){return(0,a.W)("/file/getProjects",{method:"GET",params:e})}async function i(e){return(0,a.W)("/file/writeEnv",{method:"POST",data:e})}async function o(e){return(0,a.W)("/file/getEnvDeps",{method:"GET",params:e})}async function r(){return(0,a.W)("/file/getActionRecordList",{method:"GET"})}async function c(e){return(0,a.W)("/file/environmentSetting",{method:"GET",params:e})}}}]);