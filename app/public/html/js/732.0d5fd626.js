"use strict";(self["webpackChunkvue_test"]=self["webpackChunkvue_test"]||[]).push([[732],{732:function(t,e,i){i.r(e),i.d(e,{default:function(){return D}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dash-board"},[e("div",{staticClass:"left"},[e("task-list"),e("task-trend")],1),e("div",{staticClass:"right"},[e("team-members")],1)])},o=[],a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dash-borard-task-list"},[e("div",{staticClass:"top-title borderBottom"},[t._v(t._s(t.title))]),t.allJobs?.length?e("el-table",{attrs:{data:t.allJobs,"show-header":!1}},[e("el-table-column",{attrs:{prop:"",label:"占位用的",width:"10px"}}),e("el-table-column",{attrs:{prop:"description",label:"描述"}}),e("el-table-column",{attrs:{prop:"builtBy",label:"构建用户"}}),e("el-table-column",{attrs:{prop:"",label:"时间"},scopedSlots:t._u([{key:"default",fn:function(i){return[i.row.building?e("span",[t._v(t._s("构建中"))]):e("span",[t._v(t._s(0===i.row.lastBuildTime?"尚未构建":t.getTimeGap(i.row.lastBuildTime)))])]}}],null,!1,2420227242)}),e("el-table-column",{attrs:{fixed:"right",label:"操作",width:"200",align:"right"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-button",{directives:[{name:"show",rawName:"v-show",value:i.row.building&&i.row.id,expression:"scope.row.building && scope.row.id"}],staticClass:"primaryColor",attrs:{icon:"el-icon-view",title:"查看构建日志",circle:""},on:{click:function(e){return e.stopPropagation(),t.getBuildLog(i.row.description,i.row.id)}}}),e("el-button",{directives:[{name:"show",rawName:"v-show",value:!i.row.building,expression:"!scope.row.building"}],staticClass:"primaryColor",attrs:{icon:"el-icon-video-play",title:"构建项目",circle:"",loading:i.row.building,disabled:!i.row.buildable},on:{click:function(e){return e.stopPropagation(),t.handleBuildClick(i.row.key)}}}),e("el-button",{directives:[{name:"show",rawName:"v-show",value:i.row.building,expression:"scope.row.building"}],staticStyle:{color:"red"},attrs:{icon:"el-icon-circle-close",circle:"",title:"停止构建",disabled:!i.row.building},on:{click:function(e){return e.stopPropagation(),t.handleStopBuildJob(i.row.queueId,i.row.id,i.row.key)}}}),e("el-button",{attrs:{icon:"el-icon-download",circle:"",title:i.row.id?"下载文件":"上次没有构建成功，无法下载",loading:i.row.building,disabled:!i.row.id},on:{click:function(e){return e.stopPropagation(),t.handleDownLoadClick(i.row.description)}}}),e("el-button",{attrs:{icon:"el-icon-edit",circle:"",title:"编辑环境"},on:{click:function(e){return e.stopPropagation(),t.handleEditEnvClick(i.row)}}})]}}],null,!1,1715917291)})],1):e("el-empty",{attrs:{description:"没有建立任务"}}),e("el-dialog",{attrs:{"custom-class":"task-trend-dialog",center:!0,top:"10vh",title:t.dialog.title,visible:t.dialog.visible},on:{"update:visible":function(e){return t.$set(t.dialog,"visible",e)}}},[t._v(" "+t._s(t.dialog.info)+" ")])],1)},n=[],r=i(7861);async function l(t){return(0,r.W)("/jenkins/buildWithParameters",{method:"GET",params:t})}async function c(t){return(0,r.W)("/jenkins/downloadFile",{method:"GET",params:t,responseType:"blob"})}async function d(t){return(0,r.W)("/jenkins/stopBuildJob",{method:"POST",data:t})}async function u(t){return(0,r.W)("/jenkins/getBuildLog",{method:"GET",params:t})}var m=i(5e3);const p=t=>{const e=(new Date).getTime(),i=(e-t)/1e3,s=Math.floor(i/31536e3)>0?new Date(t).toLocaleDateString().replace(/\//g,"-"):null,o=Math.floor(i/2592e3)>0?`${Math.floor(i/2592e3)} 个月前 ( ${new Date(t).toLocaleDateString().replace(/\//g,"-")} )`:null,a=Math.floor(i/86400)>0?`${Math.floor(i/86400)} 天前`:null,n=Math.floor(i/3600)>0?`${Math.floor(i/3600)} 小时前`:null,r=Math.floor(i/60)>0?`${Math.floor(i/60)} 分钟前`:null,l=`${Math.floor(i)} 秒前`;return s??o??a??n??r??l},h=(t,e)=>{const i=new Blob([t]),s=window.URL.createObjectURL(i),o=document.createElement("a");o.href=s,o.download=e,o.click(),o.remove(),window.URL.revokeObjectURL(s)};var g={components:{},name:"TaskList",data(){return{title:"任务列表",allJobs:[],dialog:{title:"",visible:!1,info:""}}},methods:{getTimeGap:p,async getAllProjects(){const t=await(0,m.mW)();t.code>0&&(this.allJobs=t.data)},async handleBuildClick(t){const e=await l({projectName:t});e.code>0&&this.getAllProjects(),this.$message({message:e.msg,type:e.code>0?"success":"error"})},async handleDownLoadClick(t,e){const i=await c({downloadTarget:t});h(i,`${t}${e??""}.zip`)},async handleStopBuildJob(t,e,i){const s=await d({queueId:t,id:e,projectName:i});this.$message({message:s.msg,type:s.code>0?"success":"error"})},async getBuildLog(t,e){const i=await u({id:e});i.code>0&&(this.dialog.info=i.data,this.dialog.title=`${t}\t${e}`,this.dialog.visible=!0)},handleEditEnvClick(t,e,i){this.$store.commit("setEnvInfo",t),this.$router.push({path:"/TaskSetting"})}},mounted(){this.getAllProjects()},sockets:{jenkinsAllJobs(t){this.allJobs=JSON.parse(t)},jenkinsFileDownLoad(t){const{envName:e,id:i}=t}}},b=g,f=i(1001),v=(0,f.Z)(b,a,n,!1,null,"734defe1",null),w=v.exports,k=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dash-borard-task-trend"},[e("div",{staticClass:"top-title borderBottom"},[e("span",[t._v(t._s(t.title))]),e("span",{staticClass:"top-title-more",attrs:{title:"更多"},on:{click:t.onMoreClick}},[e("i",{staticClass:"el-icon-more"})])]),t.recordList?.length?e("div",{staticClass:"dash-borard-task-trend-list"},t._l(t.recordList,(function(i){return e("div",{key:i.time,staticClass:"list-content borderBottom"},[e("el-avatar",{style:{marginRight:"14px"},attrs:{src:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"}}),e("div",{staticStyle:{width:"100%"}},[e("div",{staticStyle:{"text-align":"left"}},[e("span",[t._v(t._s(i.userName))]),i.envName?e("span",[t._v(t._s(" 在 ")),e("span",{staticClass:"primaryColor"},[t._v(t._s(i.envName))])]):t._e(),e("span",[t._v(t._s(` ${i.actionDec} `))]),e("span",{staticClass:"primaryColor"},[t._v(t._s(i.action))]),i.buildId?e("span",{staticClass:"primaryColor",staticStyle:{margin:"0 14px",cursor:"pointer",float:"right"},on:{click:function(e){return t.getBuildLog(i.envName,i.buildId)}}},[t._v(t._s("查看日志"))]):t._e()]),e("div",{staticClass:"list-time"},[t._v(" "+t._s(t.getTimeGap(i.time))+" ")])])],1)})),0):e("el-empty",{attrs:{description:"没有进行过构建"}}),e("el-dialog",{attrs:{"custom-class":"task-trend-dialog",center:!0,top:"10vh",title:t.dialog.title,visible:t.dialog.visible},on:{"update:visible":function(e){return t.$set(t.dialog,"visible",e)}}},[t._v(" "+t._s(t.dialog.info)+" ")])],1)},y=[],_={components:{},name:"TaskTrend",data(){return{title:"动态",recordList:[],dialog:{title:"",visible:!1,info:""}}},methods:{getTimeGap:p,async getActionLists(){const t=await(0,m.r3)();t.code>0&&(this.recordList=t.data)},async getBuildLog(t,e){const i=await u({id:e});i.code>0&&(this.dialog.info=i.data,this.dialog.title=`${t}\t${e}`,this.dialog.visible=!0)},onMoreClick(){this.$router.push({path:"/TaskListDetail"})}},mounted(){this.getActionLists()},sockets:{actionRecordLists(t){this.recordList=JSON.parse(t)}}},C=_,T=(0,f.Z)(C,k,y,!1,null,"5e20cf69",null),L=T.exports,S=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dash-borard-team-members"},[e("div",{staticClass:"top-title borderBottom"},[t._v(t._s(t.title))]),t.members?.length?e("div",t._l(t.members,(function(i){return e("div",{key:i.id,staticClass:"team-content"},[e("el-avatar",{style:{marginRight:"14px"},attrs:{src:i.avaUrl}}),e("div",[t._v(t._s(i.name))])],1)})),0):e("el-empty",{attrs:{description:"没有团队人员"}})],1)},B=[],$=i(9195),W={components:{},name:"TeamMembers",data(){return{title:"团队成员",members:[]}},methods:{async getMembers(){const t=await(0,$.Zw)();t.code>0&&(this.members=t.data)}},mounted(){this.getMembers()}},M=W,P=(0,f.Z)(M,S,B,!1,null,"3ff64faf",null),E=P.exports,j={components:{TaskList:w,TaskTrend:L,TeamMembers:E},name:"DashBoard",data(){return{}},methods:{}},x=j,G=(0,f.Z)(x,s,o,!1,null,null,null),D=G.exports},5e3:function(t,e,i){i.d(e,{B_:function(){return n},Ti:function(){return l},Z1:function(){return a},mW:function(){return o},r3:function(){return r}});var s=i(7861);async function o(t){return(0,s.W)("/file/getProjects",{method:"GET",params:t})}async function a(t){return(0,s.W)("/file/writeEnv",{method:"POST",data:t})}async function n(t){return(0,s.W)("/file/getEnvDeps",{method:"GET",params:t})}async function r(t){return(0,s.W)("/file/getActionRecordList",{method:"POST",data:t})}async function l(t){return(0,s.W)("/file/environmentSetting",{method:"GET",params:t})}},9195:function(t,e,i){i.d(e,{Zw:function(){return n},bG:function(){return r},bs:function(){return l},kS:function(){return a},x4:function(){return o}});var s=i(7861);const o=async t=>(0,s.W)("/user/login",{method:"POST",data:t}),a=async t=>(0,s.W)("/user/logout",{method:"POST",data:t}),n=async t=>(0,s.W)("/user/getMembers",{method:"GET",params:t}),r=async t=>(0,s.W)("/user/getUserInfo",{method:"GET",params:t}),l=async t=>(0,s.W)("/user/changePassWord",{method:"POST",data:t})}}]);