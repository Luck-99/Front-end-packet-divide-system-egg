"use strict";(self["webpackChunkvue_test"]=self["webpackChunkvue_test"]||[]).push([[762],{5762:function(t,e,n){n.r(e),n.d(e,{default:function(){return D}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dash-board"},[e("div",{staticClass:"left"},[e("task-list"),e("task-trend")],1),e("div",{staticClass:"right"},[e("team-members")],1)])},a=[],o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dash-borard-task-list"},[e("div",{staticClass:"top-title borderBottom"},[t._v(t._s(t.title))]),t.allJobs?.length?e("el-table",{attrs:{data:t.allJobs,"show-header":!1}},[e("el-table-column",{attrs:{prop:"",label:"占位用的",width:"10px"}}),e("el-table-column",{attrs:{prop:"description",label:"描述"}}),e("el-table-column",{attrs:{prop:"builtBy",label:"构建用户"}}),e("el-table-column",{attrs:{prop:"",label:"时间"},scopedSlots:t._u([{key:"default",fn:function(n){return[n.row.building?e("span",[t._v(t._s("构建中"))]):e("span",[t._v(t._s(0===n.row.lastBuildTime?"尚未构建":t.getTimeGap(n.row.lastBuildTime)))])]}}],null,!1,2420227242)}),e("el-table-column",{attrs:{fixed:"right",label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(n){return[e("el-button",{directives:[{name:"show",rawName:"v-show",value:!n.row.building,expression:"!scope.row.building"}],staticClass:"primaryColor",attrs:{icon:"el-icon-video-play",title:"构建项目",circle:"",loading:n.row.building,disabled:!n.row.buildable},on:{click:function(e){return e.stopPropagation(),t.handleBuildClick(n.row.key)}}}),e("el-button",{directives:[{name:"show",rawName:"v-show",value:n.row.building,expression:"scope.row.building"}],staticStyle:{color:"red"},attrs:{icon:"el-icon-circle-close",circle:"",title:"停止构建",disabled:!n.row.building},on:{click:function(e){return e.stopPropagation(),t.handleStopBuildJob(n.row.queueId,n.row.id,n.row.key)}}}),e("el-button",{attrs:{icon:"el-icon-download",circle:"",title:"下载文件",loading:n.row.building},on:{click:function(e){return e.stopPropagation(),t.handleDownLoadClick(n.row.description)}}}),e("el-button",{attrs:{icon:"el-icon-edit",circle:"",title:"编辑环境"},on:{click:function(e){return e.stopPropagation(),t.handleEditEnvClick(n.row)}}})]}}],null,!1,2191643653)})],1):e("el-empty",{attrs:{description:"没有建立任务"}})],1)},i=[],r=n(7861);async function l(t){return(0,r.W)("/jenkins/buildWithParameters",{method:"GET",params:t})}async function c(t){return(0,r.W)("/jenkins/downloadFile",{method:"GET",params:t,responseType:"blob"})}async function d(t){return(0,r.W)("/jenkins/stopBuildJob",{method:"POST",data:t})}async function u(t){return(0,r.W)("/jenkins/getBuildLog",{method:"GET",params:t})}var m=n(5e3);const p=t=>{const e=(new Date).getTime(),n=(e-t)/1e3,s=Math.floor(n/31536e3)>0?new Date(t).toLocaleDateString().replace(/\//g,"-"):null,a=Math.floor(n/2592e3)>0?`${Math.floor(n/2592e3)} 个月前 ( ${new Date(t).toLocaleDateString().replace(/\//g,"-")} )`:null,o=Math.floor(n/86400)>0?`${Math.floor(n/86400)} 天前`:null,i=Math.floor(n/3600)>0?`${Math.floor(n/3600)} 小时前`:null,r=Math.floor(n/60)>0?`${Math.floor(n/60)} 分钟前`:null,l=`${Math.floor(n)} 秒前`;return s??a??o??i??r??l},h=(t,e)=>{const n=new Blob([t]),s=window.URL.createObjectURL(n),a=document.createElement("a");a.href=s,a.download=e,a.click(),a.remove(),window.URL.revokeObjectURL(s)};var b={components:{},name:"TaskList",data(){return{title:"任务列表",allJobs:[]}},methods:{getTimeGap:p,async getAllProjects(){const t=await(0,m.mW)();t.code>0&&(this.allJobs=t.data)},async handleBuildClick(t){const e=await l({projectName:t});e.code>0&&this.getAllProjects(),this.$message({message:e.msg,type:e.code>0?"success":"error"})},async handleDownLoadClick(t,e){const n=await c({downloadTarget:t});h(n,`${t}${e??""}.zip`)},async handleStopBuildJob(t,e,n){const s=await d({queueId:t,id:e,projectName:n});this.$message({message:s.msg,type:s.code>0?"success":"error"})},handleEditEnvClick(t,e,n){this.$store.commit("setEnvInfo",t),this.$router.push({path:"/TaskSetting"})}},mounted(){this.getAllProjects()},sockets:{jenkinsAllJobs(t){this.allJobs=JSON.parse(t)},jenkinsFileDownLoad(t){const{envName:e,id:n}=t}}},f=b,g=n(1001),v=(0,g.Z)(f,o,i,!1,null,"e639ea4e",null),w=v.exports,_=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dash-borard-task-trend"},[e("div",{staticClass:"top-title borderBottom"},[t._v(t._s(t.title))]),t.recordList?.length?e("div",{staticClass:"dash-borard-task-trend-list"},t._l(t.recordList,(function(n){return e("div",{key:n.time,staticClass:"list-content borderBottom"},[e("el-avatar",{style:{marginRight:"14px"},attrs:{src:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"}}),e("div",[e("div",[e("span",[t._v(t._s(n.userName))]),n.envName?e("span",[t._v(t._s(" 在 ")),e("span",{staticClass:"primaryColor"},[t._v(t._s(n.envName))])]):t._e(),e("span",[t._v(t._s(` ${n.actionDec} `))]),e("span",{staticClass:"primaryColor"},[t._v(t._s(n.action))]),n.buildId?e("span",{staticStyle:{margin:"0 14px",cursor:"pointer"},on:{click:function(e){return t.getBuildLog(n.envName,n.buildId)}}},[t._v(t._s(`#${n.buildId}`))]):t._e()]),e("div",{staticClass:"list-time"},[t._v(" "+t._s(t.getTimeGap(n.time))+" ")])])],1)})),0):e("el-empty",{attrs:{description:"没有进行过构建"}}),e("el-dialog",{attrs:{"custom-class":"task-trend-dialog",center:!0,top:"10vh",title:t.dialog.title,visible:t.dialog.visible},on:{"update:visible":function(e){return t.$set(t.dialog,"visible",e)}}},[t._v(" "+t._s(t.dialog.info)+" ")])],1)},k=[],y={components:{},name:"TaskTrend",data(){return{title:"动态",recordList:[],dialog:{title:"",visible:!1,info:""}}},methods:{getTimeGap:p,async getActionLists(){const t=await(0,m.r3)();t.code>0&&(this.recordList=t.data)},async getBuildLog(t,e){const n=await u({id:e});n.code>0&&(this.dialog.info=n.data,this.dialog.title=`${t}\t${e}`,this.dialog.visible=!0)}},mounted(){this.getActionLists()},sockets:{actionRecordLists(t){this.recordList=JSON.parse(t)}}},T=y,C=(0,g.Z)(T,_,k,!1,null,"330f7ced",null),L=C.exports,B=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dash-borard-team-members"},[e("div",{staticClass:"top-title borderBottom"},[t._v(t._s(t.title))]),t.members?.length?e("div",t._l(t.members,(function(n){return e("div",{key:n.id,staticClass:"team-content"},[e("el-avatar",{style:{marginRight:"14px"},attrs:{src:n.avaUrl}}),e("div",[t._v(t._s(n.name))])],1)})),0):e("el-empty",{attrs:{description:"没有团队人员"}})],1)},E=[],S=n(9195),$={components:{},name:"TeamMembers",data(){return{title:"团队成员",members:[]}},methods:{async getMembers(){const t=await(0,S.Zw)();t.code>0&&(this.members=t.data)}},mounted(){this.getMembers()}},W=$,M=(0,g.Z)(W,B,E,!1,null,"3ff64faf",null),j=M.exports,G={components:{TaskList:w,TaskTrend:L,TeamMembers:j},name:"DashBoard",data(){return{}},methods:{}},P=G,x=(0,g.Z)(P,s,a,!1,null,null,null),D=x.exports},5e3:function(t,e,n){n.d(e,{B_:function(){return i},Ti:function(){return l},Z1:function(){return o},mW:function(){return a},r3:function(){return r}});var s=n(7861);async function a(t){return(0,s.W)("/file/getProjects",{method:"GET",params:t})}async function o(t){return(0,s.W)("/file/writeEnv",{method:"POST",data:t})}async function i(t){return(0,s.W)("/file/getEnvDeps",{method:"GET",params:t})}async function r(){return(0,s.W)("/file/getActionRecordList",{method:"GET"})}async function l(t){return(0,s.W)("/file/environmentSetting",{method:"GET",params:t})}},9195:function(t,e,n){n.d(e,{Zw:function(){return i},bG:function(){return r},kS:function(){return o},x4:function(){return a}});var s=n(7861);const a=async t=>(0,s.W)("/login",{method:"POST",data:t}),o=async t=>(0,s.W)("/logout",{method:"POST",data:t}),i=async t=>(0,s.W)("/getMembers",{method:"GET",params:t}),r=async t=>(0,s.W)("/getUserInfo",{method:"GET",params:t})}}]);