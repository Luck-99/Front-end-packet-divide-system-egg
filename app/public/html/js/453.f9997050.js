"use strict";(self["webpackChunkvue_test"]=self["webpackChunkvue_test"]||[]).push([[453],{6453:function(t,e,s){s.r(e),s.d(e,{default:function(){return D}});var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dash-board"},[e("div",{staticClass:"left"},[e("task-list"),e("task-trend")],1),e("div",{staticClass:"right"},[e("team-members")],1)])},a=[],o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dash-borard-task-list"},[e("div",{staticClass:"top-title borderBottom"},[t._v(t._s(t.title))]),t.allJobs?.length?e("el-table",{attrs:{data:t.allJobs,"show-header":!1}},[e("el-table-column",{attrs:{prop:"",label:"占位用的",width:"10px"}}),e("el-table-column",{attrs:{prop:"description",label:"描述"}}),e("el-table-column",{attrs:{prop:"builtBy",label:"构建用户"}}),e("el-table-column",{attrs:{prop:"",label:"时间"},scopedSlots:t._u([{key:"default",fn:function(s){return[s.row.building?e("span",[t._v(t._s("构建中"))]):e("span",[t._v(t._s(0===s.row.lastBuildTime?"尚未构建":t.getTimeGap(s.row.lastBuildTime)))])]}}],null,!1,2420227242)}),e("el-table-column",{attrs:{fixed:"right",label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-button",{directives:[{name:"show",rawName:"v-show",value:!s.row.building,expression:"!scope.row.building"}],staticClass:"primaryColor",attrs:{icon:"el-icon-video-play",title:"构建项目",circle:"",loading:s.row.building,disabled:!s.row.buildable},on:{click:function(e){return e.stopPropagation(),t.handleBuildClick(s.row.key)}}}),e("el-button",{directives:[{name:"show",rawName:"v-show",value:s.row.building,expression:"scope.row.building"}],staticStyle:{color:"red"},attrs:{icon:"el-icon-circle-close",circle:"",title:"停止构建",disabled:!s.row.building},on:{click:function(e){return e.stopPropagation(),t.handleStopBuildJob(s.row.queueId,s.row.id,s.row.key)}}}),e("el-button",{attrs:{icon:"el-icon-download",circle:"",title:s.row.id?"下载文件":"上次没有构建成功，无法下载",loading:s.row.building,disabled:!s.row.id},on:{click:function(e){return e.stopPropagation(),t.handleDownLoadClick(s.row.description)}}}),e("el-button",{attrs:{icon:"el-icon-edit",circle:"",title:"编辑环境"},on:{click:function(e){return e.stopPropagation(),t.handleEditEnvClick(s.row)}}})]}}],null,!1,2013206330)})],1):e("el-empty",{attrs:{description:"没有建立任务"}})],1)},i=[],r=s(7861);async function l(t){return(0,r.W)("/jenkins/buildWithParameters",{method:"GET",params:t})}async function c(t){return(0,r.W)("/jenkins/downloadFile",{method:"GET",params:t,responseType:"blob"})}async function d(t){return(0,r.W)("/jenkins/stopBuildJob",{method:"POST",data:t})}async function u(t){return(0,r.W)("/jenkins/getBuildLog",{method:"GET",params:t})}var m=s(5e3);const p=t=>{const e=(new Date).getTime(),s=(e-t)/1e3,n=Math.floor(s/31536e3)>0?new Date(t).toLocaleDateString().replace(/\//g,"-"):null,a=Math.floor(s/2592e3)>0?`${Math.floor(s/2592e3)} 个月前 ( ${new Date(t).toLocaleDateString().replace(/\//g,"-")} )`:null,o=Math.floor(s/86400)>0?`${Math.floor(s/86400)} 天前`:null,i=Math.floor(s/3600)>0?`${Math.floor(s/3600)} 小时前`:null,r=Math.floor(s/60)>0?`${Math.floor(s/60)} 分钟前`:null,l=`${Math.floor(s)} 秒前`;return n??a??o??i??r??l},h=(t,e)=>{const s=new Blob([t]),n=window.URL.createObjectURL(s),a=document.createElement("a");a.href=n,a.download=e,a.click(),a.remove(),window.URL.revokeObjectURL(n)};var b={components:{},name:"TaskList",data(){return{title:"任务列表",allJobs:[]}},methods:{getTimeGap:p,async getAllProjects(){const t=await(0,m.mW)();t.code>0&&(this.allJobs=t.data)},async handleBuildClick(t){const e=await l({projectName:t});e.code>0&&this.getAllProjects(),this.$message({message:e.msg,type:e.code>0?"success":"error"})},async handleDownLoadClick(t,e){const s=await c({downloadTarget:t});h(s,`${t}${e??""}.zip`)},async handleStopBuildJob(t,e,s){const n=await d({queueId:t,id:e,projectName:s});this.$message({message:n.msg,type:n.code>0?"success":"error"})},handleEditEnvClick(t,e,s){this.$store.commit("setEnvInfo",t),this.$router.push({path:"/TaskSetting"})}},mounted(){this.getAllProjects()},sockets:{jenkinsAllJobs(t){this.allJobs=JSON.parse(t)},jenkinsFileDownLoad(t){const{envName:e,id:s}=t}}},f=b,g=s(1001),v=(0,g.Z)(f,o,i,!1,null,"2fb6c571",null),w=v.exports,_=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dash-borard-task-trend"},[e("div",{staticClass:"top-title borderBottom"},[t._v(t._s(t.title))]),t.recordList?.length?e("div",{staticClass:"dash-borard-task-trend-list"},t._l(t.recordList,(function(s){return e("div",{key:s.time,staticClass:"list-content borderBottom"},[e("el-avatar",{style:{marginRight:"14px"},attrs:{src:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"}}),e("div",[e("div",[e("span",[t._v(t._s(s.userName))]),s.envName?e("span",[t._v(t._s(" 在 ")),e("span",{staticClass:"primaryColor"},[t._v(t._s(s.envName))])]):t._e(),e("span",[t._v(t._s(` ${s.actionDec} `))]),e("span",{staticClass:"primaryColor"},[t._v(t._s(s.action))]),s.buildId?e("span",{staticStyle:{margin:"0 14px",cursor:"pointer"},on:{click:function(e){return t.getBuildLog(s.envName,s.buildId)}}},[t._v(t._s(`#${s.buildId}`))]):t._e()]),e("div",{staticClass:"list-time"},[t._v(" "+t._s(t.getTimeGap(s.time))+" ")])])],1)})),0):e("el-empty",{attrs:{description:"没有进行过构建"}}),e("el-dialog",{attrs:{"custom-class":"task-trend-dialog",center:!0,top:"10vh",title:t.dialog.title,visible:t.dialog.visible},on:{"update:visible":function(e){return t.$set(t.dialog,"visible",e)}}},[t._v(" "+t._s(t.dialog.info)+" ")])],1)},k=[],y={components:{},name:"TaskTrend",data(){return{title:"动态",recordList:[],dialog:{title:"",visible:!1,info:""}}},methods:{getTimeGap:p,async getActionLists(){const t=await(0,m.r3)();t.code>0&&(this.recordList=t.data)},async getBuildLog(t,e){const s=await u({id:e});s.code>0&&(this.dialog.info=s.data,this.dialog.title=`${t}\t${e}`,this.dialog.visible=!0)}},mounted(){this.getActionLists()},sockets:{actionRecordLists(t){this.recordList=JSON.parse(t)}}},T=y,C=(0,g.Z)(T,_,k,!1,null,"c6065ff2",null),L=C.exports,B=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dash-borard-team-members"},[e("div",{staticClass:"top-title borderBottom"},[t._v(t._s(t.title))]),t.members?.length?e("div",t._l(t.members,(function(s){return e("div",{key:s.id,staticClass:"team-content"},[e("el-avatar",{style:{marginRight:"14px"},attrs:{src:s.avaUrl}}),e("div",[t._v(t._s(s.name))])],1)})),0):e("el-empty",{attrs:{description:"没有团队人员"}})],1)},S=[],W=s(9195),E={components:{},name:"TeamMembers",data(){return{title:"团队成员",members:[]}},methods:{async getMembers(){const t=await(0,W.Zw)();t.code>0&&(this.members=t.data)}},mounted(){this.getMembers()}},$=E,M=(0,g.Z)($,B,S,!1,null,"3ff64faf",null),P=M.exports,j={components:{TaskList:w,TaskTrend:L,TeamMembers:P},name:"DashBoard",data(){return{}},methods:{}},G=j,x=(0,g.Z)(G,n,a,!1,null,null,null),D=x.exports},5e3:function(t,e,s){s.d(e,{B_:function(){return i},Ti:function(){return l},Z1:function(){return o},mW:function(){return a},r3:function(){return r}});var n=s(7861);async function a(t){return(0,n.W)("/file/getProjects",{method:"GET",params:t})}async function o(t){return(0,n.W)("/file/writeEnv",{method:"POST",data:t})}async function i(t){return(0,n.W)("/file/getEnvDeps",{method:"GET",params:t})}async function r(){return(0,n.W)("/file/getActionRecordList",{method:"GET"})}async function l(t){return(0,n.W)("/file/environmentSetting",{method:"GET",params:t})}},9195:function(t,e,s){s.d(e,{Zw:function(){return i},bG:function(){return r},bs:function(){return l},kS:function(){return o},x4:function(){return a}});var n=s(7861);const a=async t=>(0,n.W)("/user/login",{method:"POST",data:t}),o=async t=>(0,n.W)("/user/logout",{method:"POST",data:t}),i=async t=>(0,n.W)("/user/getMembers",{method:"GET",params:t}),r=async t=>(0,n.W)("/user/getUserInfo",{method:"GET",params:t}),l=async t=>(0,n.W)("/user/changePassWord",{method:"POST",data:t})}}]);